{"nodes":[{"width":384,"height":172,"id":"BgeBaseChineseEmbeddings-100868c8-4f09-42a4-8a2d-d7a8b725a40a","type":"genericNode","position":{"x":4.826686031186297,"y":124.09583926528795},"data":{"type":"BgeBaseChineseEmbeddings","node":{"template":{"_type":"BgeBaseChineseEmbeddings"},"description":"","base_classes":["Embeddings","BgeBaseChineseEmbeddings"],"display_name":"BgeBaseChineseEmbeddings"},"id":"BgeBaseChineseEmbeddings-100868c8-4f09-42a4-8a2d-d7a8b725a40a","value":null},"selected":false,"positionAbsolute":{"x":4.826686031186297,"y":124.09583926528795},"dragging":false},{"width":384,"height":232,"id":"YuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9e","type":"genericNode","position":{"x":-12.655789534065434,"y":-292.8311531624461},"data":{"type":"YuqueSplitter","node":{"template":{"documents":{"required":true,"placeholder":"","show":true,"multiline":false,"password":false,"name":"documents","advanced":false,"type":"BaseLoader","list":false},"_type":"YuqueSplitter"},"description":"将语雀知识库文档按照段落与标题进行切分","base_classes":["BaseDocumentTransformer","YuqueSplitter","TextSplitter"],"display_name":"YuqueSplitter"},"id":"YuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9e","value":null},"positionAbsolute":{"x":-12.655789534065434,"y":-292.8311531624461},"selected":false,"dragging":false},{"width":384,"height":428,"id":"YuqueLoader-ad8e0bef-60b3-426e-924a-470f357056d7","type":"genericNode","position":{"x":-580.6302358503248,"y":-476.0778611219954},"data":{"type":"YuqueLoader","node":{"template":{"yuque_group_name":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"rpta1n","password":false,"name":"yuque_group_name","display_name":"语雀团队（英文）","advanced":false,"type":"str","list":false},"yuque_knowledge_base":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"hpwrgb","password":false,"name":"yuque_knowledge_base","display_name":"语雀知识库（英文）","advanced":false,"type":"str","list":false},"yuque_token":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"0PFRnYR7By97sWBGHBEFImL7vC3CcxeKxrNvYpHa","password":true,"name":"yuque_token","display_name":"语雀 Token","advanced":false,"type":"str","list":false},"_type":"YuqueLoader"},"description":"加载文档所在文档库所有文档。语雀团队管理员可在 团队设置-> 开发者-> Token-> 查看详情 中找到 Token","base_classes":["BaseLoader","YuqueLoader"],"display_name":"YuqueLoader"},"id":"YuqueLoader-ad8e0bef-60b3-426e-924a-470f357056d7","value":null},"positionAbsolute":{"x":-580.6302358503248,"y":-476.0778611219954},"selected":false,"dragging":false},{"width":384,"height":414,"id":"FAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225","type":"genericNode","position":{"x":578.3654913524152,"y":23.00360904900515},"data":{"type":"FAISS_WHOOSH","node":{"template":{"documents":{"required":true,"placeholder":"","show":true,"multiline":false,"password":false,"name":"documents","display_name":"Text Splitter","advanced":false,"dynamic":false,"info":"","type":"TextSplitter","list":true},"embedding":{"required":true,"placeholder":"","show":true,"multiline":false,"password":false,"name":"embedding","display_name":"Embedding","advanced":false,"dynamic":false,"info":"","type":"Embeddings","list":false},"top_k":{"required":true,"placeholder":"","show":true,"multiline":false,"value":4,"password":false,"name":"top_k","display_name":"检索个数","advanced":false,"dynamic":false,"info":"","type":"int","list":false},"search_type":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"similarity","password":false,"options":["similarity","mmr","whoosh","similarity_whoosh"],"name":"search_type","display_name":"检索方式","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"metadatas":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"metadatas","advanced":false,"dynamic":false,"info":"","type":"code","list":true},"ids":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"ids","advanced":false,"dynamic":false,"info":"","type":"str","list":true},"kwargs":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"kwargs","advanced":true,"dynamic":false,"info":"","type":"Any","list":false},"_type":"FAISS_WHOOSH"},"description":"Construct FAISS wrapper from raw documents.","base_classes":["VectorStore","FAISS_WHOOSH","BaseRetriever"],"custom_fields":{},"documentation":"","display_name":"FAISS_WHOOSH"},"id":"FAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225","value":null},"positionAbsolute":{"x":578.3654913524152,"y":23.00360904900515},"selected":false,"dragging":false},{"width":384,"height":284,"id":"JsonPromptTemplate-ba812edb-7cd3-443b-a436-62fa4de68b12","type":"genericNode","position":{"x":1201.4950029822114,"y":-401.51793176241017},"data":{"type":"JsonPromptTemplate","node":{"template":{"template":{"required":true,"placeholder":"","show":true,"multiline":true,"password":false,"name":"template","advanced":false,"dynamic":false,"info":"","type":"prompt","list":false,"value":"给定以下对话和后续问题，用其原始语言将后续问题重新表述为独立问题.\n\n对话历史:\n{chat_history}\n后续输入: {input}\n独立问题:"},"_type":"JsonPromptTemplate"},"description":"支持 json 格式的输入，原生的 prompt 模版不支持，会把 json 当作变量","base_classes":["BasePromptTemplate"],"custom_fields":{},"output_types":[],"documentation":"","display_name":"JsonPromptTemplate"},"id":"JsonPromptTemplate-ba812edb-7cd3-443b-a436-62fa4de68b12","value":null},"positionAbsolute":{"x":1201.4950029822114,"y":-401.51793176241017},"selected":false,"dragging":true},{"width":384,"height":412,"id":"PythonFunctionTool-114a8a92-b9a1-4ba5-bddc-6f9ac6ab672b","type":"genericNode","position":{"x":735.1668263094664,"y":-560.2845075864728},"data":{"type":"PythonFunctionTool","node":{"template":{"name":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"添加额外信息","password":false,"name":"name","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"description":{"required":true,"placeholder":"","show":true,"multiline":true,"value":"可以通过http请求从其他服务获取额外的信息，添加总结 prompt 里面\n也可以对已有的数据做个转换","password":false,"name":"description","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"code":{"required":true,"placeholder":"","show":true,"multiline":true,"value":"\nimport requests\nimport logging\nimport json\n\ndef python_function(queryInfo: str) -> dict[str:str]:\n    logging.info(\"param \" + str(queryInfo) )   \n    \"\"\" 可以调用 http 服务 或者 自定义返回某个字段\"\"\"\n    \"\"\" mock 处理, 字典的 key 要与 prompt 中占位符保持一致  \"\"\"\n    result = {'preProcessToolResult': ''}\n    return result\n","password":false,"name":"code","advanced":false,"dynamic":false,"info":"","type":"code","list":false},"_type":"PythonFunctionTool"},"description":"Python function to be executed.","base_classes":["Tool"],"custom_fields":{},"output_types":[],"documentation":"","display_name":"PythonFunctionTool"},"id":"PythonFunctionTool-114a8a92-b9a1-4ba5-bddc-6f9ac6ab672b","value":null},"positionAbsolute":{"x":735.1668263094664,"y":-560.2845075864728},"selected":false,"dragging":false},{"width":384,"height":354,"id":"ConversationWindowMemory-76a9dbd0-1155-4ed6-ae22-983b420c5533","type":"genericNode","position":{"x":398.0320475749488,"y":-900.484542884929},"data":{"type":"ConversationWindowMemory","node":{"template":{"lc_kwargs":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"lc_kwargs","advanced":true,"dynamic":false,"info":"","type":"code","list":false},"human_prefix":{"required":false,"placeholder":"","show":false,"multiline":false,"value":"Human","password":false,"name":"human_prefix","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"ai_prefix":{"required":false,"placeholder":"","show":false,"multiline":false,"value":"AI","password":false,"name":"ai_prefix","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"memory_key":{"required":false,"placeholder":"","show":true,"multiline":false,"value":"chat_history","password":false,"name":"memory_key","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"k":{"required":true,"placeholder":"","show":true,"multiline":false,"value":10,"password":false,"name":"k","display_name":"Memory Size","advanced":false,"dynamic":false,"info":"","type":"int","list":false},"session_chat_memory":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"session_chat_memory","advanced":false,"dynamic":false,"info":"","type":"code","list":false},"chat_memory":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"chat_memory","advanced":false,"dynamic":false,"info":"","type":"BaseChatMessageHistory","list":false},"output_key":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"output_key","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"input_key":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"input_key","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"return_messages":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"return_messages","advanced":false,"dynamic":false,"info":"","type":"bool","list":false},"_type":"ConversationWindowMemory"},"description":"把对话的上下文原样存入内存, size 表示要记录的会话轮数, key 要和 prompt 模版的占位符对齐","base_classes":["BaseMemory","ConversationWindowMemory","LangflowBaseMemory","Serializable"],"custom_fields":{},"output_types":[],"documentation":"","display_name":"多轮内存会话记忆-支持会话隔离"},"id":"ConversationWindowMemory-76a9dbd0-1155-4ed6-ae22-983b420c5533","value":null},"positionAbsolute":{"x":398.0320475749488,"y":-900.484542884929},"dragging":false,"selected":false},{"width":384,"height":284,"id":"JsonPromptTemplate-075a1501-6604-44dd-9627-dd96f87bc8ac","type":"genericNode","position":{"x":1258.4138339253907,"y":-1339.8386519870614},"data":{"type":"JsonPromptTemplate","node":{"template":{"template":{"required":true,"placeholder":"","show":true,"multiline":true,"password":false,"name":"template","advanced":false,"dynamic":false,"info":"","type":"prompt","list":false,"value":"使用以下信息来回答最后的问题。如果你不知道答案，就说你不知道，不要试图编造答案.\n-------------------------------\n上下文信息: \n```{context}```\n\n额外信息：{preProcessToolResult}\n\n历史对话信息：{chat_history}\n----------------------------------------\n用户提问：{input}\n\n\n"},"_type":"JsonPromptTemplate"},"description":"支持 json 格式的输入，原生的 prompt 模版不支持，会把 json 当作变量","base_classes":["BasePromptTemplate"],"custom_fields":{},"output_types":[],"documentation":"","display_name":"JsonPromptTemplate"},"id":"JsonPromptTemplate-075a1501-6604-44dd-9627-dd96f87bc8ac","value":null},"positionAbsolute":{"x":1258.4138339253907,"y":-1339.8386519870614},"selected":false},{"width":384,"height":292,"id":"LLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449","type":"genericNode","position":{"x":1718.6349769867575,"y":-85.64473980018721},"data":{"type":"LLMSessionChain","node":{"template":{"lc_kwargs":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"lc_kwargs","advanced":false,"dynamic":false,"info":"","type":"code","list":false},"memory":{"required":false,"placeholder":"","show":true,"multiline":false,"password":false,"name":"memory","advanced":false,"dynamic":false,"info":"","type":"LangflowBaseMemory","list":false},"callbacks":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"callbacks","advanced":false,"dynamic":false,"info":"","type":"langchain.callbacks.base.BaseCallbackHandler","list":true},"verbose":{"required":false,"placeholder":"","show":true,"multiline":false,"value":false,"password":false,"name":"verbose","advanced":true,"dynamic":false,"info":"","type":"bool","list":false},"tags":{"required":false,"placeholder":"","show":false,"multiline":false,"password":false,"name":"tags","advanced":false,"dynamic":false,"info":"","type":"str","list":true},"prompt":{"required":true,"placeholder":"","show":true,"multiline":false,"password":false,"name":"prompt","advanced":false,"dynamic":false,"info":"","type":"BasePromptTemplate","list":false},"llm":{"required":true,"placeholder":"","show":true,"multiline":false,"password":false,"name":"llm","advanced":false,"dynamic":false,"info":"","type":"BaseLanguageModel","list":false},"output_key":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"text","password":false,"name":"output_key","advanced":true,"dynamic":false,"info":"","type":"str","list":false},"_type":"LLMSessionChain"},"description":"","base_classes":["LLMSessionChain","Serializable","Chain","function"],"custom_fields":{},"output_types":[],"documentation":"","display_name":"LLMSessionChain"},"id":"LLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449","value":null},"positionAbsolute":{"x":1718.6349769867575,"y":-85.64473980018721},"selected":false,"dragging":false},{"width":384,"height":746,"id":"CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2","type":"genericNode","position":{"x":2077.4678783864238,"y":-842.0345410914905},"data":{"type":"CustomCrp","node":{"template":{"code":{"dynamic":true,"required":true,"placeholder":"","show":false,"multiline":true,"value":"import logging\nfrom typing import Optional\n\nfrom langchain import BasePromptTemplate\nfrom langchain.base_language import BaseLanguageModel\nfrom langchain.chains.question_answering import load_qa_chain\n\nfrom langflow.custom.chains.LLMSessionChain import LLMSessionChain\nfrom langflow.custom.chains.custom_crp.base import CustomRAGChain\nfrom langflow.custom.chains.custom_crp.prompts import QA_PROMPT\nfrom langflow import CustomComponent\nfrom langchain.schema import BaseRetriever, BaseMemory\nfrom langchain.agents.tools import Tool\n\n\nclass CustomCrp(CustomComponent):\n    display_name: str = \"RAG会话Chain-V3\"\n    description: str = \"支持多轮会话，前处理，问题改写等功能，自定义能力参考：\"\n    beta = True\n\n    field_config = {\n        \"chain_type\": { \"options\": [\"stuff\", \"map_reduce\", \"refine\", \"map_rerank\"], \"value\": \"stuff\", \"display_name\":  \"文档合并类型\"},\n        \"answer_prompt\": {\"required\": True, \"display_name\": \"大模型总结 prompt\"},\n        \"rewrite_question\": {\"required\": False,\"display_name\":  \"原始问题改写chain\"},\n        \"return_source_documents\": {\"display_name\":  \"是否返回原始文档\"},\n        \"return_yuque_link\": {\"display_name\":  \"是否返回语雀链接\"},\n        \"llm\": {\"display_name\":  \"LLM(大语言模型)\"},\n        \"input_keys\": {\"display_name\":  \"input_keys(输入提问的参数名，默认input,如有多个用空格分隔)\", \"value\": \"input\"},\n        \"retriever\": {\"display_name\":  \"Retriever(检索器)\"},\n        \"return_generated_question\": {\"display_name\":  \"是否返回改写后的问题\"},\n        \"memory\": {\"required\": False},\n        \"preProcessTool\": {\"required\": False, \"display_name\":  \"自定义前处理 Tool, 用 PythonFunctionTool 接入\"},\n        \"code\": {\"show\": False}\n    }\n\n    def build(\n        self,\n        llm: BaseLanguageModel,\n        memory: Optional[BaseMemory] = None,\n        return_yuque_link: bool = False,\n        preProcessTool: Tool = None,\n        retriever: BaseRetriever = None,\n        rewrite_question: LLMSessionChain = None,\n        answer_prompt: BasePromptTemplate = QA_PROMPT,\n        chain_type: str = \"stuff\",\n        return_source_documents: bool = False,\n        return_generated_question: bool = False,\n        input_keys: str = None\n    ) -> CustomRAGChain:\n\n        input_keys_list = input_keys.split(' ')\n\n        doc_chain = load_qa_chain(\n            llm,\n            chain_type=chain_type,\n            verbose=True,\n            callbacks=None,\n        )\n\n        doc_chain.llm_chain.prompt = answer_prompt\n        logging.info(doc_chain.llm_chain.prompt)\n\n        return CustomRAGChain(\n            llm=llm,\n            memory=memory,\n            retriever=retriever,\n            return_yuque_link=return_yuque_link,\n            preProcessTool=preProcessTool,\n            combine_docs_chain=doc_chain,\n            chain_type=chain_type,\n            question_generator=rewrite_question,\n            return_source_documents=return_source_documents,\n            return_generated_question=return_generated_question,\n            input_keys=input_keys_list\n        )\n\n\n\n","password":false,"name":"code","advanced":false,"type":"code","list":false},"_type":"CustomComponent","answer_prompt":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"QA_PROMPT","password":false,"name":"answer_prompt","display_name":"大模型总结 prompt","advanced":false,"dynamic":false,"info":"","type":"BasePromptTemplate","list":false},"chain_type":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"stuff","password":false,"options":["stuff","map_reduce","refine","map_rerank"],"name":"chain_type","display_name":"文档合并类型","advanced":false,"dynamic":false,"info":"","type":"str","list":true},"input_keys":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"input","password":false,"name":"input_keys","display_name":"input_keys(输入提问的参数名，默认input,如有多个用空格分隔)","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"llm":{"required":true,"placeholder":"","show":true,"multiline":false,"password":false,"name":"llm","display_name":"LLM(大语言模型)","advanced":false,"dynamic":false,"info":"","type":"BaseLanguageModel","list":false},"memory":{"required":false,"placeholder":"","show":true,"multiline":false,"password":false,"name":"memory","display_name":"memory","advanced":false,"dynamic":false,"info":"","type":"BaseMemory","list":false},"preProcessTool":{"required":false,"placeholder":"","show":true,"multiline":false,"password":false,"name":"preProcessTool","display_name":"自定义前处理 Tool, 用 PythonFunctionTool 接入","advanced":false,"dynamic":false,"info":"","type":"Tool","list":false},"retriever":{"required":true,"placeholder":"","show":true,"multiline":false,"password":false,"name":"retriever","display_name":"Retriever(检索器)","advanced":false,"dynamic":false,"info":"","type":"BaseRetriever","list":false},"return_generated_question":{"required":true,"placeholder":"","show":true,"multiline":false,"value":true,"password":false,"name":"return_generated_question","display_name":"是否返回改写后的问题","advanced":false,"dynamic":false,"info":"","type":"bool","list":false},"return_source_documents":{"required":true,"placeholder":"","show":true,"multiline":false,"value":true,"password":false,"name":"return_source_documents","display_name":"是否返回原始文档","advanced":false,"dynamic":false,"info":"","type":"bool","list":false},"return_yuque_link":{"required":true,"placeholder":"","show":true,"multiline":false,"value":true,"password":false,"name":"return_yuque_link","display_name":"是否返回语雀链接","advanced":false,"dynamic":false,"info":"","type":"bool","list":false},"rewrite_question":{"required":false,"placeholder":"","show":true,"multiline":false,"password":false,"name":"rewrite_question","display_name":"原始问题改写chain","advanced":false,"dynamic":false,"info":"","type":"LLMSessionChain","list":false}},"description":"支持多轮会话，前处理，问题改写等功能，自定义能力参考：","base_classes":[],"custom_fields":{"answer_prompt":null,"chain_type":null,"input_keys":null,"llm":null,"memory":null,"preProcessTool":null,"retriever":null,"return_generated_question":null,"return_source_documents":null,"return_yuque_link":null,"rewrite_question":null},"output_types":["CustomCrp"],"documentation":"","display_name":"RAG会话Chain-V3","beta":true},"id":"CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2","value":null},"positionAbsolute":{"x":2077.4678783864238,"y":-842.0345410914905},"selected":false,"dragging":false},{"id":"Qwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66","type":"genericNode","position":{"x":1196.0023778918721,"y":-1130.279774635861},"data":{"type":"Qwen15 14B Chat","node":{"template":{"code":{"dynamic":true,"required":true,"placeholder":"","show":false,"multiline":true,"value":"import json\nimport logging\nfrom typing import Optional, List, Dict, Mapping, Any\n\nimport requests\nfrom langchain.llms.base import BaseLLM\nfrom langchain.llms.base import LLM\n\nfrom langflow import CustomComponent\n\nlogging.basicConfig(level=logging.INFO)\n\n\nclass custom_llm(CustomComponent):\n    display_name: str = \"qwen15_14b_chat\"\n    description: str = \"qwen15_14b_chat\"\n\n    def build_config(self):\n        return {\n            \"temperature\": {\"display_name\": \"temperature\"},\n            \"top_p\": {\"display_name\": \"top_p\"},\n            \"repetition_penalty\": {\"display_name\": \"repetition_penalty\"},\n            \"top_k\": {\"display_name\": \"top_k\"},\n            \"max_tokens\": {\"display_name\": \"max_tokens\"},\n            \"system_content\": {\"display_name\": \"system_content\"},\n            \"stop\": {\"display_name\": \"stop\"},\n            \"code\": {\"show\": False},\n        }\n\n    def build(\n            self,\n            temperature=0.7,\n            top_p=0.8,\n            top_k=-1,\n            repetition_penalty=1.05,\n            max_tokens=512,\n            system_content=\"一个有用的助手\",\n            stop=\"final_answer\",\n    ) -> BaseLLM:\n        try:\n            output = self.qwen15_14b_chat(\n                temperature=temperature,\n                top_p=top_p,\n                repetition_penalty=repetition_penalty,\n                max_tokens=max_tokens,\n                system_content=system_content,\n                top_k=top_k,\n                stop=stop,\n            )\n        except Exception as e:\n            raise ValueError(\"qwen15_14b_chat model error!\") from e\n        return output\n\n    class qwen15_14b_chat(LLM):\n        temperature = 0.7\n        top_p = 0.8\n        top_k = 40\n        repetition_penalty = 0.1\n        max_tokens = 512\n        system_content = \"有用的助手\"\n        stop = \"\"\n        url = \"http://gateway-cv-pre.alipay.com/ua/invoke\"\n\n        @property\n        def _llm_type(self) -> str:\n            return \"qwen15_14b_chat\"\n\n        def _construct_query(self, prompt: str) -> Dict:\n            payload = {\n                \"serviceCode\": \"max_qwen15_14b_chat\",\n                \"uri\": \"v1\",\n                \"attributes\": {\n                    \"_ROUTE_\": \"MAYA\",\n                    \"_TIMEOUT_\": \"300000\",\n                    \"_APP_TOKEN_\": \"d695b694-e241-4728-b32a-46d89785a737\"\n                },\n                \"params\": {\n                    \"features\": {\n                        \"data\": \"{\\\"api_version\\\": \\\"v2\\\", \\\"out_seq_length\\\": 512, \\\"prompts\\\": [{\\\"prompt\\\": [{\\\"content\\\": \\\"写一个快排程序\\\", \\\"role\\\": \\\"<human>\\\"}], \\\"repetition_penalty\\\": 1.1, \\\"temperature\\\": 0.2, \\\"top_k\\\": 40, \\\"top_p\\\": 0.9}], \\\"stream\\\": false}\"\n\n                    }\n                }\n            }\n            payload['params']['features']['data'] = json.dumps({\n                \"messages\": [\n                    {\"role\": \"system\", \"content\": self.system_content},\n                    {\"role\": \"user\", \"content\": prompt}\n                ],\n                \"temperature\": self.temperature,\n                \"top_p\": self.top_p,\n                \"top_k\": self.top_k,\n                \"repetition_penalty\": self.repetition_penalty,\n                \"max_tokens\": self.max_tokens,\n                \"stop\": self.stop\n            })\n\n            logging.info(\"------------------------------------ʕ •ᴥ•ʔ------------------------------------\")\n            logging.info(\"qwen15_14b_chat prompt: \\n\" + str(prompt))\n            logging.info(\"------------------------------------ʕ •ᴥ•ʔ------------------------------------\\n\\n\\n\")\n            return payload\n\n        @classmethod\n        def _post(cls, url: str,\n                  query: Dict) -> Any:\n            # print(\"query: \" )\n            _headers = {'Content-Type': 'application/json'}\n            \"\"\"POST请求\n            \"\"\"\n            with requests.session() as sess:\n                resp = sess.post(url,\n                                 json=query,\n                                 headers=_headers,\n                                 timeout=120)\n            return resp\n\n        def _call(self, prompt: str,\n                  stop: Optional[List[str]] = None) -> str:\n            \"\"\"_call\n            \"\"\"\n            # 模型服务url\n            url = \"http://gateway-cv-pre.alipay.com/ua/invoke\"\n\n            # construct query\n            query = self._construct_query(prompt=prompt)\n\n            # post\n            response = self._post(url=url,\n                              query=query)\n\n            if response.status_code == 200:\n                resp_json = response.json()\n                logging.info(resp_json)\n                try:\n                    if resp_json.get('success'):\n                        predictions = resp_json['resultMap']['attributes']['res']\n                    else:\n                        predictions = json.loads(resp_json)\n                    logging.info(\"------------------------------------ʕ •ᴥ•ʔ------------------------------------\")\n                    logging.info(\"qwen15_14b_chat response: \\n\" + str(predictions))\n                    logging.info(\"------------------------------------ʕ •ᴥ•ʔ------------------------------------\\n\\n\\n\")\n                    return predictions\n                except Exception as e:\n                    logging.error(e)\n                    logging.info(\"请求失败\")\n                    return \"请求模型失败，请重试。\"\n\n            else:\n                return \"请求模型失败，请重试\"\n\n        @property\n        def _identifying_params(self) -> Mapping[str, Any]:\n            \"\"\"Get the identifying parameters.\n            \"\"\"\n            _param_dict = {\n                \"url\": self.url\n            }\n            return _param_dict\n\n","password":false,"name":"code","advanced":false,"type":"code","list":false},"_type":"CustomComponent","max_tokens":{"required":true,"placeholder":"","show":true,"multiline":false,"value":512,"password":false,"name":"max_tokens","display_name":"max_tokens","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"repetition_penalty":{"required":true,"placeholder":"","show":true,"multiline":false,"value":1.05,"password":false,"name":"repetition_penalty","display_name":"repetition_penalty","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"stop":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"final_answer","password":false,"name":"stop","display_name":"stop","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"system_content":{"required":true,"placeholder":"","show":true,"multiline":false,"value":"一个有用的助手","password":false,"name":"system_content","display_name":"system_content","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"temperature":{"required":true,"placeholder":"","show":true,"multiline":false,"value":0.7,"password":false,"name":"temperature","display_name":"temperature","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"top_k":{"required":true,"placeholder":"","show":true,"multiline":false,"value":-1,"password":false,"name":"top_k","display_name":"top_k","advanced":false,"dynamic":false,"info":"","type":"str","list":false},"top_p":{"required":true,"placeholder":"","show":true,"multiline":false,"value":0.8,"password":false,"name":"top_p","display_name":"top_p","advanced":false,"dynamic":false,"info":"","type":"str","list":false}},"description":"qwen15_14b_chat","base_classes":["BaseLanguageModel","BaseLLM"],"custom_fields":{"max_tokens":null,"repetition_penalty":null,"stop":null,"system_content":null,"temperature":null,"top_k":null,"top_p":null},"output_types":["Qwen15 14B Chat"],"documentation":"","display_name":"qwen15_14b_chat"},"id":"Qwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66","value":null},"width":384,"height":696,"positionAbsolute":{"x":1196.0023778918721,"y":-1130.279774635861},"selected":false,"dragging":false}],"edges":[{"source":"YuqueLoader-ad8e0bef-60b3-426e-924a-470f357056d7","sourceHandle":"{œbaseClassesœ:[œBaseLoaderœ,œYuqueLoaderœ],œdataTypeœ:œYuqueLoaderœ,œidœ:œYuqueLoader-ad8e0bef-60b3-426e-924a-470f357056d7œ}","target":"YuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9e","targetHandle":"{œfieldNameœ:œdocumentsœ,œidœ:œYuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9eœ,œtypeœ:œBaseLoaderœ}","style":{"stroke":"inherit"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-YuqueLoader-ad8e0bef-60b3-426e-924a-470f357056d7{œbaseClassesœ:[œBaseLoaderœ,œYuqueLoaderœ],œdataTypeœ:œYuqueLoaderœ,œidœ:œYuqueLoader-ad8e0bef-60b3-426e-924a-470f357056d7œ}-YuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9e{œfieldNameœ:œdocumentsœ,œidœ:œYuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9eœ,œtypeœ:œBaseLoaderœ}","selected":false},{"source":"YuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9e","sourceHandle":"{œbaseClassesœ:[œBaseDocumentTransformerœ,œYuqueSplitterœ,œTextSplitterœ],œdataTypeœ:œYuqueSplitterœ,œidœ:œYuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9eœ}","target":"FAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225","targetHandle":"{œfieldNameœ:œdocumentsœ,œidœ:œFAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225œ,œtypeœ:œTextSplitterœ}","style":{"stroke":"inherit"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-YuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9e{œbaseClassesœ:[œBaseDocumentTransformerœ,œYuqueSplitterœ,œTextSplitterœ],œdataTypeœ:œYuqueSplitterœ,œidœ:œYuqueSplitter-b1ded98b-5b8f-42fb-854f-dba8b23b2b9eœ}-FAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225{œfieldNameœ:œdocumentsœ,œidœ:œFAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225œ,œtypeœ:œTextSplitterœ}","selected":false},{"source":"BgeBaseChineseEmbeddings-100868c8-4f09-42a4-8a2d-d7a8b725a40a","sourceHandle":"{œbaseClassesœ:[œEmbeddingsœ,œBgeBaseChineseEmbeddingsœ],œdataTypeœ:œBgeBaseChineseEmbeddingsœ,œidœ:œBgeBaseChineseEmbeddings-100868c8-4f09-42a4-8a2d-d7a8b725a40aœ}","target":"FAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225","targetHandle":"{œfieldNameœ:œembeddingœ,œidœ:œFAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225œ,œtypeœ:œEmbeddingsœ}","style":{"stroke":"inherit"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-BgeBaseChineseEmbeddings-100868c8-4f09-42a4-8a2d-d7a8b725a40a{œbaseClassesœ:[œEmbeddingsœ,œBgeBaseChineseEmbeddingsœ],œdataTypeœ:œBgeBaseChineseEmbeddingsœ,œidœ:œBgeBaseChineseEmbeddings-100868c8-4f09-42a4-8a2d-d7a8b725a40aœ}-FAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225{œfieldNameœ:œembeddingœ,œidœ:œFAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225œ,œtypeœ:œEmbeddingsœ}","selected":false},{"source":"JsonPromptTemplate-ba812edb-7cd3-443b-a436-62fa4de68b12","sourceHandle":"{œbaseClassesœ:[œBasePromptTemplateœ],œdataTypeœ:œJsonPromptTemplateœ,œidœ:œJsonPromptTemplate-ba812edb-7cd3-443b-a436-62fa4de68b12œ}","target":"LLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449","targetHandle":"{œfieldNameœ:œpromptœ,œidœ:œLLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449œ,œtypeœ:œBasePromptTemplateœ}","style":{"stroke":"#555"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-JsonPromptTemplate-ba812edb-7cd3-443b-a436-62fa4de68b12{œbaseClassesœ:[œBasePromptTemplateœ],œdataTypeœ:œJsonPromptTemplateœ,œidœ:œJsonPromptTemplate-ba812edb-7cd3-443b-a436-62fa4de68b12œ}-LLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449{œfieldNameœ:œpromptœ,œidœ:œLLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449œ,œtypeœ:œBasePromptTemplateœ}","selected":false},{"source":"JsonPromptTemplate-075a1501-6604-44dd-9627-dd96f87bc8ac","sourceHandle":"{œbaseClassesœ:[œBasePromptTemplateœ],œdataTypeœ:œJsonPromptTemplateœ,œidœ:œJsonPromptTemplate-075a1501-6604-44dd-9627-dd96f87bc8acœ}","target":"CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2","targetHandle":"{œfieldNameœ:œanswer_promptœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œBasePromptTemplateœ}","style":{"stroke":"#555"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-JsonPromptTemplate-075a1501-6604-44dd-9627-dd96f87bc8ac{œbaseClassesœ:[œBasePromptTemplateœ],œdataTypeœ:œJsonPromptTemplateœ,œidœ:œJsonPromptTemplate-075a1501-6604-44dd-9627-dd96f87bc8acœ}-CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2{œfieldNameœ:œanswer_promptœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œBasePromptTemplateœ}","selected":false},{"source":"ConversationWindowMemory-76a9dbd0-1155-4ed6-ae22-983b420c5533","sourceHandle":"{œbaseClassesœ:[œBaseMemoryœ,œConversationWindowMemoryœ,œLangflowBaseMemoryœ,œSerializableœ],œdataTypeœ:œConversationWindowMemoryœ,œidœ:œConversationWindowMemory-76a9dbd0-1155-4ed6-ae22-983b420c5533œ}","target":"CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2","targetHandle":"{œfieldNameœ:œmemoryœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œBaseMemoryœ}","style":{"stroke":"#555"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-ConversationWindowMemory-76a9dbd0-1155-4ed6-ae22-983b420c5533{œbaseClassesœ:[œBaseMemoryœ,œConversationWindowMemoryœ,œLangflowBaseMemoryœ,œSerializableœ],œdataTypeœ:œConversationWindowMemoryœ,œidœ:œConversationWindowMemory-76a9dbd0-1155-4ed6-ae22-983b420c5533œ}-CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2{œfieldNameœ:œmemoryœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œBaseMemoryœ}","selected":false},{"source":"PythonFunctionTool-114a8a92-b9a1-4ba5-bddc-6f9ac6ab672b","sourceHandle":"{œbaseClassesœ:[œToolœ],œdataTypeœ:œPythonFunctionToolœ,œidœ:œPythonFunctionTool-114a8a92-b9a1-4ba5-bddc-6f9ac6ab672bœ}","target":"CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2","targetHandle":"{œfieldNameœ:œpreProcessToolœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œToolœ}","style":{"stroke":"#555"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-PythonFunctionTool-114a8a92-b9a1-4ba5-bddc-6f9ac6ab672b{œbaseClassesœ:[œToolœ],œdataTypeœ:œPythonFunctionToolœ,œidœ:œPythonFunctionTool-114a8a92-b9a1-4ba5-bddc-6f9ac6ab672bœ}-CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2{œfieldNameœ:œpreProcessToolœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œToolœ}","selected":false},{"source":"LLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449","sourceHandle":"{œbaseClassesœ:[œLLMSessionChainœ,œSerializableœ,œChainœ,œfunctionœ],œdataTypeœ:œLLMSessionChainœ,œidœ:œLLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449œ}","target":"CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2","targetHandle":"{œfieldNameœ:œrewrite_questionœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œLLMSessionChainœ}","style":{"stroke":"#555"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-LLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449{œbaseClassesœ:[œLLMSessionChainœ,œSerializableœ,œChainœ,œfunctionœ],œdataTypeœ:œLLMSessionChainœ,œidœ:œLLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449œ}-CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2{œfieldNameœ:œrewrite_questionœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œLLMSessionChainœ}","selected":false},{"source":"FAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225","sourceHandle":"{œbaseClassesœ:[œVectorStoreœ,œFAISS_WHOOSHœ,œBaseRetrieverœ],œdataTypeœ:œFAISS_WHOOSHœ,œidœ:œFAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225œ}","target":"CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2","targetHandle":"{œfieldNameœ:œretrieverœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œBaseRetrieverœ}","style":{"stroke":"#555"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-FAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225{œbaseClassesœ:[œVectorStoreœ,œFAISS_WHOOSHœ,œBaseRetrieverœ],œdataTypeœ:œFAISS_WHOOSHœ,œidœ:œFAISS_WHOOSH-00f1d108-ef5a-482b-b198-afbf6e1dc225œ}-CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2{œfieldNameœ:œretrieverœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œBaseRetrieverœ}","selected":false},{"source":"Qwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66","sourceHandle":"{œbaseClassesœ:[œBaseLanguageModelœ,œBaseLLMœ],œdataTypeœ:œQwen15 14B Chatœ,œidœ:œQwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66œ}","target":"CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2","targetHandle":"{œfieldNameœ:œllmœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œBaseLanguageModelœ}","style":{"stroke":"#555"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-Qwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66{œbaseClassesœ:[œBaseLanguageModelœ,œBaseLLMœ],œdataTypeœ:œQwen15 14B Chatœ,œidœ:œQwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66œ}-CustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2{œfieldNameœ:œllmœ,œidœ:œCustomCrp-7f140ede-b8cf-45a7-94f8-1fdbb62d1ad2œ,œtypeœ:œBaseLanguageModelœ}","selected":false},{"source":"Qwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66","sourceHandle":"{œbaseClassesœ:[œBaseLanguageModelœ,œBaseLLMœ],œdataTypeœ:œQwen15 14B Chatœ,œidœ:œQwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66œ}","target":"LLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449","targetHandle":"{œfieldNameœ:œllmœ,œidœ:œLLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449œ,œtypeœ:œBaseLanguageModelœ}","style":{"stroke":"#555"},"className":"stroke-gray-900","animated":false,"id":"reactflow__edge-Qwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66{œbaseClassesœ:[œBaseLanguageModelœ,œBaseLLMœ],œdataTypeœ:œQwen15 14B Chatœ,œidœ:œQwen15 14B Chat-dfcd42c9-2080-4cb4-86df-f764746c5b66œ}-LLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449{œfieldNameœ:œllmœ,œidœ:œLLMSessionChain-ff8687ff-1f76-41de-a3de-00c034ea6449œ,œtypeœ:œBaseLanguageModelœ}","selected":false}],"viewport":{"x":501.15334820059985,"y":503.2118918980192,"zoom":0.5003456494863567}}
